# Маппинг колонок YouGile → статусы Redmine (черновик)

Этот документ фиксирует предложение по тому, как переносить колонки из YouGile в статусы задач Redmine.

## Исключаемые сущности YouGile

При построении маппинга считаем, что следующие сущности **не мигрируем** (служебные или временные):

- **Проекты**:
  - `ERP_NEW` (будет удалён из YouGile)

- **Доски (boards)**, создаваемые самим YouGile или служебные:
  - `Планирование`
  - `Мониторинг задач`
  - `Сводка` (в т.ч. доска `Сводка` внутри проекта `Внедрение ERP НОВЫЙ`)

Все остальные проекты и доски считаем «рабочими» и учитываем их колонки при миграции.

## Группы колонок-статусов

Из рабочих досок остаётся ограниченный набор колонок, которые **по смыслу являются статусами**. Их удобно свернуть в 4–5 логических групп.

### 1. Группа «новые / очередь»

Колонки YouGile:

- `Новая колонка`
- `Новые задачи`
- `Новое`
- `План`
- `В очереди`

Целевая идея: маппить в один из «начальных» статусов Redmine (например, `Новая` / `К выполнению` / аналогичный существующий статус).

### 2. Группа «в работе»

Колонки YouGile:

- `В работе`
- `В работе без срока`

Целевая идея: маппить в рабочий статус Redmine (например, `В работе`).

### 3. Группа «тестирование»

Колонки YouGile:

- `Тестирование`
- `Тестирование (проверка)`

Целевая идея: маппить в статус Redmine вроде `Тестирование` / `Проверка качества`.

### 4. Группа «завершено»

Колонки YouGile:

- `Выполнено`
- `Готово`
- `Согласовано`

Целевая идея: маппить в завершающий статус Redmine (например, `Выполнено` / `Закрыто`).

### 5. Группа «отменено / отклонено»

Колонки YouGile:

- `Отклонено`
- `Отклоненные задачи`
- `Аннулировано`

Целевая идея: маппить в статус Redmine, обозначающий отмену или отклонение задачи (например, `Отклонено` / `Отменено`).

## Служебные и тематические колонки

Есть колонки, которые **не являются стадиями выполнения**, а описывают область, тип или особый вид задач. Примеры:

- `База знаний`
- личные/планировочные колонки и т.п. (на системных досках, которые мы в целом не мигрируем)

Для таких колонок предлагается стратегия:

- В Redmine ставить **один из базовых статусов** (чаще всего `Новая` или `В работе`).
- Исходное имя колонки YouGile **сохранять в отдельное кастомное поле**, например `YouGile Column`.

Так пользователи в Redmine будут видеть и стандартный статус workflow, и дополнительную информацию о том, в какой именно колонке YouGile задача жила.

## Реализация

✅ **Маппинг реализован** в модуле `src/config/column_status_mapping.py`

### Используемые статусы Redmine

- **Новая** - для новых задач и задач в очереди
- **В работе** - для задач в работе
- **Нужен отклик** - для задач на тестировании
- **Решена** - для выполненных задач
- **Согласовано** - отдельный статус для согласованных задач
- **Отклонена** - для отменённых/отклонённых задач
- **Закрыта** - доступен, но не используется в маппинге

### Синхронизация задач

Функция `sync_tasks()` в модуле `src/services/redmine_task_sync.py`:
- Читает задачи из локальной БД YouGile
- Определяет статус Redmine по названию колонки (без нормализации)
- Создаёт issues в Redmine с правильными статусами
- Пропускает удалённые и архивированные задачи
- Поддерживает dry-run режим

### Использование

```bash
# Dry-run (по умолчанию)
python -m cli sync redmine --entities tasks

# Применить изменения
python -m cli sync redmine --entities tasks --apply

# Синхронизировать всё (users, projects, boards, tasks)
python -m cli sync redmine --entities all --apply
```
